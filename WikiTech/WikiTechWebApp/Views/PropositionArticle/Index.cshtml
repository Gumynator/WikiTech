@*
    //Auteur    : Loris habegger
    //Date      : 27.04.2021
    //Fichier   : Index.chtml (proposition d'article)
    //Perso     : Droit géré dans le controlleur, image tiny mce,

*@

@using Microsoft.AspNetCore.Identity
@using WikiTechWebApp.Areas.Identity.Data
@using WikiTechAPI.Models
@model WikiTechAPI.Models.Article
@inject SignInManager<ApplicationUser> signInManager;



@{ ViewData["Title"] = "Proposition d'article"; }

<body>
    <h1>Ici vous pourrez proposer un article à Wikitech !</h1>
    <h3>Veuillez entrez les informations qui vous sont demandées</h3>

    <form asp-action="Create" methode="POST">
        <input asp-for="Id" class="form-control" type="text" placeholder="Disabled readonly input" aria-label="Disabled input example" value="@User.Identity.Name" disabled readonly>

        <div class="mb-3">
            <label for="titlearea" class="form-label">Titre de l'article</label>
            <textarea asp-for="TitreArticle" class="form-control" id="titlearea" rows="1"></textarea>
            @Html.ValidationMessageFor(m => m.TitreArticle, "", new { @class = "text-danger" })
        </div>

        <div class="mb-3">
            <label for="descarea" class="form-label">Description de l'article</label>
            <textarea asp-for="DescriptionArticle" class="form-control" id="descarea" rows="3"></textarea>
            @Html.ValidationMessageFor(m => m.DescriptionArticle, "", new { @class = "text-danger" })
        </div>
        <div class="mb-3">
            <label for="TinyArea" class="form-label">Rédaction de l'article</label>
            <textarea asp-for="TextArticle" class="form-control" id="TinyArea" rows="20" cols="300"></textarea>
            @Html.ValidationMessageFor(m => m.TextArticle, "", new { @class = "text-danger" })
        </div>

        <div class="form-check">
            <label for="Selectsection" class="form-label">Quelle catégorie aura votre article ?</label>
            <div id="rdsection"></div>
            @Html.ValidationMessageFor(m => m.IdSection, "", new { @class = "text-danger" })
        </div>
        </br>

        <div class="form-group">
            <label for="selectTag" class="form-label">Quel(s) Tag(s) voulez-vous pour votre article ? </label>
            <select asp-for="Referencer" class="selectpicker" id="selectTag" name="tags" multiple data-live-search="true"></select>
        </div>
        </br>

        <div class="form-check">
            <input asp-for="IsqualityArticle" class="form-check-input" type="checkbox" id="checkQuality">
            <label class="form-check-label" for="checkQuality">
                 Article de qualité ?
            </label>
        </div>
        </br>

        <input class="btn btn-outline-success btn-lg" type="submit" value="Soumettre">
    </form>
</body>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<script>

    $(document).ready(function () {
        getTags();
        getSection();

    }
    )
    function getTags() {
        $.ajax(
            {
                url: "http://localhost:59601/Api/Tags",
                type: "GET",
                dataType: "JSON",
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    createTagSelect(data);
                }
            });
    }

    function createTagSelect(data) {
        var select = $("#selectTag");

        $.each(data, function (key, value) {
            console.log(value);
            var element = "<option value=\"" + value.idTag + "\">" + value.nomTag + "</option>";
            select.append(element);
        })
    }

    function getSection() {
        $.ajax(
            {
                url: "http://localhost:59601/Api/Sections",
                type: "GET",
                dataType: "JSON",
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    createSectionSelect(data);
                }
            });
    }

    function createSectionSelect(data) {
        var select = $("#rdsection");

        $.each(data, function (key, value) {
            console.log(value);
            var element = "<input asp-for=\"IdSection\" id=\"Selectsection\" value=\"" + value.idSection + "\" type=\"radio\" checked classe=\"form-check-input \" name=\"rdsection\"\">" + "   " + value.nomSection + "  ";
            select.append(element);
        })
    }

</script>
